<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Delivery Pro Fix</title>
    <script src="https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcdnjs.cloudflare.com%2Fajax%2Flibs%2FSortable%2F1.15.0%2FSortable.min.js&data=05%7C02%7C%7C763c2c6da541414d9d6908de6c381ba5%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C639067185384123227%7CUnknown%7CTWFpbGZsb3d8eyJFbXB0eU1hcGkiOnRydWUsIlYiOiIwLjAuMDAwMCIsIlAiOiJXaW4zMiIsIkFOIjoiTWFpbCIsIldUIjoyfQ%3D%3D%7C0%7C%7C%7C&sdata=Nf7VB8wkcHlCPXHOKlu4twexqpp7oJZCr9cl7TJFETA%3D&reserved=0"></script>
    <style>
        :root { --p: #2563eb; --bg: #f1f5f9; --txt: #0f172a; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding-bottom: 100px; color: var(--txt); }
        .nav { display: flex; background: white; border-bottom: 2px solid #e2e8f0; position: sticky; top: 0; z-index: 100; }
        .nav button { flex: 1; padding: 18px 10px; border: none; background: none; font-weight: bold; cursor: pointer; color: #64748b; font-size: 14px; }
        .nav button.active { color: var(--p); border-bottom: 4px solid var(--p); }
        .container { padding: 15px; }
        .card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); display: flex; align-items: center; border: 1px solid #e2e8f0; }
        .handle { color: #cbd5e1; margin-right: 15px; cursor: grab; font-size: 24px; padding: 10px; }
        .info { flex: 1; overflow: hidden; }
        .info h4 { margin: 0 0 5px 0; font-size: 17px; }
        .info p { margin: 0; font-size: 13px; color: #64748b; }
        .btn-go { background: #22c55e; color: white; padding: 10px 15px; border-radius: 10px; border: none; font-weight: bold; }
        .btn-full { background: #0f172a; color: white; width: 100%; padding: 20px; margin-bottom: 20px; font-size: 17px; border-radius: 15px; border: none; font-weight: 800; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="nav">
    <button id="tab1" onclick="showTab('run')" class="active">Î£Î—ÎœÎ•Î¡Î™ÎÎŸ RUN</button>
    <button id="tab2" onclick="showTab('base')">Î’Î‘Î£Î—</button>
    <button id="tab3" onclick="showTab('settings')">âš™ï¸</button>
</div>

<div id="run-page" class="container">
    <button class="btn-full" onclick="startFullRoute()">ğŸš€ START FULL ROUTE (ÎŸÎ›Î‘ ÎœÎ‘Î–Î™)</button>
    <div id="run-list"></div>
</div>

<div id="base-page" class="container hidden">
    <input type="text" id="search" placeholder="ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·..." style="width:100%; padding:15px; border-radius:12px; border:2px solid #e2e8f0; margin-bottom:15px;" onkeyup="renderBase()">
    <div id="base-list"></div>
</div>

<div id="settings-page" class="container hidden">
    <div style="background:white; padding:20px; border-radius:15px;">
        <h3>Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®</h3>
        <textarea id="bulk-input" style="width:100%; height:200px; padding:10px;" placeholder="ÎŒÎ½Î¿Î¼Î± | Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·"></textarea>
        <button onclick="importData()" style="width:100%; padding:15px; background:#2563eb; color:white; border:none; border-radius:10px; margin-top:10px; font-weight:bold;">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
        <button onclick="localStorage.clear(); location.reload();" style="width:100%; margin-top:40px; color:#ef4444; background:none; border:none;">âš ï¸ ÎŸÎ»Î¹ÎºÎ® Î”Î¹Î±Î³ÏÎ±Ï†Î®</button>
    </div>
</div>

<script>
    let baseData = JSON.parse(localStorage.getItem('delivery_base') || '[]');
    let runData = JSON.parse(localStorage.getItem('delivery_run') || '[]');

    function showTab(tab) {
        document.getElementById('run-page').classList.toggle('hidden', tab !== 'run');
        document.getElementById('base-page').classList.toggle('hidden', tab !== 'base');
        document.getElementById('settings-page').classList.toggle('hidden', tab !== 'settings');
    }

    function importData() {
        const input = document.getElementById('bulk-input').value;
        input.split('\n').forEach(line => {
            const parts = line.split('|');
            if(parts.length >= 2) {
                baseData.push({ id: Date.now()+Math.random(), name: parts[0].trim(), addr: parts[1].trim() });
            }
        });
        localStorage.setItem('delivery_base', JSON.stringify(baseData));
        alert('Î— Î²Î¬ÏƒÎ· ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ!');
        renderBase();
    }

    function renderBase() {
        const s = document.getElementById('search').value.toLowerCase();
        const list = document.getElementById('base-list');
        list.innerHTML = '';
        baseData.filter(i => i.name.toLowerCase().includes(s)).forEach(item => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `<div class="info"><h4>${item.name}</h4><p>${item.addr}</p></div><button class="btn-go" style="background:#2563eb">+</button>`;
            div.querySelector('button').onclick = () => { runData.push(item); localStorage.setItem('delivery_run', JSON.stringify(runData)); renderRun(); alert('ÎœÏ€Î®ÎºÎµ ÏƒÏ„Î¿ Run!'); };
            list.appendChild(div);
        });
    }

    function renderRun() {
        const list = document.getElementById('run-list');
        list.innerHTML = '';
        runData.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'card';
            div.setAttribute('data-id', index);
            div.innerHTML = `<div class="handle">â˜°</div><div class="info"><h4>${item.name}</h4><p>${item.addr}</p></div><button class="btn-go" onclick="window.open('https://emea01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fgoogleusercontent.com%2Fmaps.google.com%2F6&data=05%7C02%7C%7C763c2c6da541414d9d6908de6c381ba5%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C639067185384137859%7CUnknown%7CTWFpbGZsb3d8eyJFbXB0eU1hcGkiOnRydWUsIlYiOiIwLjAuMDAwMCIsIlAiOiJXaW4zMiIsIkFOIjoiTWFpbCIsIldUIjoyfQ%3D%3D%7C0%7C%7C%7C&sdata=Vx34321b%2FmOa7aE8wk%2BWxPSOIl3V8tskf4pMooxE568%3D&reserved=0' + encodeURIComponent('${item.addr}'), '_blank')">GO</button>`;
            list.appendChild(div);
        });
    }

    function startFullRoute() {
        if(runData.length === 0) return alert('Î†Î´ÎµÎ¹Î¿ Run!');
       
        // Î•Î”Î© Î•Î™ÎÎ‘Î™ Î— Î”Î™ÎŸÎ¡Î˜Î©Î£Î—: ÎšÎ±Î¸Î±ÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï„Î¹Ï‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Î¿Î½ÏŒÎ¼Î±Ï„Î± ÎºÎ±Î¹ ÏƒÏÎ¼Î²Î¿Î»Î±
        const stops = runData.map(item => {
            let a = item.addr;
            if(a.includes('|')) a = a.split('|')[1]; // ÎšÏÎ¬Ï„Î± Î¼ÏŒÎ½Î¿ ÏŒ,Ï„Î¹ ÎµÎ¯Î½Î±Î¹ Î¼ÎµÏ„Î¬ Ï„Î¿ | Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
            return encodeURIComponent(a.trim());
        });

        const dest = stops.pop();
        const waypoints = stops.join('|');
        const url = `https://emea01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fgoogleusercontent.com%2Fmaps.google.com%2F7&data=05%7C02%7C%7C763c2c6da541414d9d6908de6c381ba5%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C639067185384146308%7CUnknown%7CTWFpbGZsb3d8eyJFbXB0eU1hcGkiOnRydWUsIlYiOiIwLjAuMDAwMCIsIlAiOiJXaW4zMiIsIkFOIjoiTWFpbCIsIldUIjoyfQ%3D%3D%7C0%7C%7C%7C&sdata=Gs2qFkUfk33c4lB4wi6J3O94hxAb8Wmn0INWcwpvme8%3D&reserved=0{dest}&waypoints=${waypoints}&travelmode=driving`;
       
        window.open(url, '_blank');
    }

    new Sortable(document.getElementById('run-list'), { handle: '.handle', animation: 150, onEnd: () => {
        let newRun = [];
        document.querySelectorAll('#run-list .card').forEach(el => newRun.push(runData[el.dataset.id]));
        runData = newRun;
        localStorage.setItem('delivery_run', JSON.stringify(runData));
    }});

    renderBase(); renderRun();
</script>
</body>
</html>
