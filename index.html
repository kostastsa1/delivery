<!DOCTYPE html>
<html lang="el">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
   <title>Delivery Pro v49</title>
   <script src="https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcdnjs.cloudflare.com%2Fajax%2Flibs%2FSortable%2F1.15.0%2FSortable.min.js&data=05%7C02%7C%7C00e3a05d35b9474e9ca708de6dcf2ef8%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C639068933778430331%7CUnknown%7CTWFpbGZsb3d8eyJFbXB0eU1hcGkiOnRydWUsIlYiOiIwLjAuMDAwMCIsIlAiOiJXaW4zMiIsIkFOIjoiTWFpbCIsIldUIjoyfQ%3D%3D%7C0%7C%7C%7C&sdata=DdhledlJTqgZEBX0hM4yGM00h2aZYC8CcrSoa4w6Qqc%3D&reserved=0"></script>
   <style>
       :root { --p: #30d158; --bg: #1c1c1e; --card: #2c2c2e; --txt: #ffffff; --accent: #30b0c7; }
       body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding-bottom: 120px; color: var(--txt); overflow-x: hidden; }
       .nav { display: flex; background: #000; padding-top: 45px; border-bottom: 1px solid #38383a; position: sticky; top: 0; z-index: 100; }
       .nav button { flex: 1; padding: 18px; border: none; background: none; font-weight: 700; color: #8e8e93; font-size: 13px; }
       .nav button.active { color: var(--p); border-bottom: 3px solid var(--p); }
       .container { padding: 16px; max-width: 600px; margin: auto; }
      
       .btn-main { background: var(--p); color: #000; width: 100%; padding: 20px; font-size: 18px; border-radius: 16px; border: none; font-weight: 800; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(48, 209, 88, 0.3); }
       .btn-opt { background: var(--accent); color: #000; width: 100%; padding: 12px; font-size: 14px; border-radius: 10px; border: none; font-weight: 700; margin-bottom: 20px; }

       .card { background: var(--card); border-radius: 16px; padding: 12px; margin-bottom: 12px; display: flex; align-items: center; border: 1px solid #38383a; transition: transform 0.2s; }
       .handle { color: #8e8e93; padding: 15px 20px; cursor: grab; font-size: 24px; touch-action: none; flex-shrink: 0; }
       .num-badge { background: var(--p); color: #000; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 14px; margin-right: 10px; flex-shrink: 0; }
       .info { flex: 1; overflow: hidden; pointer-events: none; } /* Î•Î¼Ï€Î¿Î´Î¯Î¶ÎµÎ¹ Ï„Î¿ drag Î±Ï€ÏŒ Ï„Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ */
       .info h4 { margin: 0; font-size: 16px; color: #fff; }
       .info p { margin: 2px 0 0 0; font-size: 13px; color: #8e8e93; }
      
       .btn-go { background: var(--accent); color: #000; border: none; width: 42px; height: 42px; border-radius: 12px; margin-left: 8px; font-weight: bold; flex-shrink: 0; }
       .btn-del { background: #ff453a; color: #fff; border: none; width: 42px; height: 42px; border-radius: 12px; margin-left: 8px; flex-shrink: 0; }
      
       .hidden { display: none; }
       textarea, input { background: #2c2c2e; border: 1px solid #38383a; color: #fff; padding: 15px; border-radius: 12px; width: 100%; box-sizing: border-box; font-size: 16px; margin-bottom: 10px; }
   </style>
</head>
<body>

<div class="nav">
   <button id="t1" onclick="tab('run')" class="active">Î”Î™Î‘Î”Î¡ÎŸÎœÎ—</button>
   <button id="t2" onclick="tab('base')">Î Î•Î›Î‘Î¤Î•Î£</button>
   <button id="t3" onclick="tab('set')">âš™ï¸ Î•Î™Î£Î‘Î“Î©Î“Î—</button>
</div>

<div id="run-page" class="container">
   <button class="btn-main" onclick="startFullRoute()">ğŸš€ Î•ÎÎ‘Î¡ÎÎ— (ÎŸÎ›Î•Î£ ÎŸÎ™ Î£Î¤Î‘Î£Î•Î™Î£)</button>
   <button class="btn-opt" onclick="smartSort()">âŒš Î£Î¥Î“ÎšÎ•ÎÎ¤Î¡Î©Î£Î— Î©Î¡Î©Î Î£Î¤ÎŸ Î¤Î•Î›ÎŸÎ£</button>
  
   <div id="run-list"></div>
  
   <button onclick="clearRun()" style="width:100%; color:#ff453a; background:none; border:none; padding:20px; font-weight:bold;">âŒ ÎšÎ‘Î˜Î‘Î¡Î™Î£ÎœÎŸÎ£ Î—ÎœÎ•Î¡Î‘Î£</button>
</div>

<div id="base-page" class="container hidden">
   <input type="text" id="search" placeholder="ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Ï€ÎµÎ»Î¬Ï„Î·..." onkeyup="renderBase()">
   <div id="base-list"></div>
</div>

<div id="set-page" class="container hidden">
   <textarea id="bulk" rows="8" placeholder="ÎŒÎ½Î¿Î¼Î± .. Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· .. ÎÏÎ± .. Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚"></textarea>
   <button onclick="saveData()" class="btn-main">Î‘Î ÎŸÎ˜Î—ÎšÎ•Î¥Î£Î— Î£Î¤Î— Î’Î‘Î£Î—</button>
</div>

<script>
   let db = JSON.parse(localStorage.getItem('delivery_db') || '[]');
   let rn = JSON.parse(localStorage.getItem('delivery_rn') || '[]');

   function tab(t) {
       document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
       document.getElementById(t + '-page').classList.remove('hidden');
       document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
       if(t==='run') { renderRun(); document.getElementById('t1').classList.add('active'); }
       if(t==='base') { renderBase(); document.getElementById('t2').classList.add('active'); }
       if(t==='set') document.getElementById('t3').classList.add('active');
   }

   function saveData() {
       const text = document.getElementById('bulk').value;
       if(!text) return;
       text.split('\n').forEach(line => {
           const p = line.split('..');
           if(p.length >= 2) db.push({ n: p[0].trim(), a: p[1].trim(), t: p[2]?.trim() || "---", nt: p[3]?.trim() || "" });
       });
       localStorage.setItem('delivery_db', JSON.stringify(db));
       document.getElementById('bulk').value = ''; tab('base');
   }

   function renderBase() {
       const s = document.getElementById('search').value.toLowerCase();
       const list = document.getElementById('base-list'); list.innerHTML = '';
       db.forEach((item, i) => {
           if(item.n.toLowerCase().includes(s) || item.a.toLowerCase().includes(s)) {
               const div = document.createElement('div');
               div.className = 'card';
               div.innerHTML = `<div class="info" style="pointer-events:auto;"><h4>${item.n}</h4><p>${item.a}</p></div>
                               <button style="background:var(--p); color:#000; border:none; padding:12px 18px; border-radius:10px; font-weight:bold;" onclick="addToRun(${i})">+</button>`;
               list.appendChild(div);
           }
       });
   }

   function addToRun(i) {
       rn.push({...db[i]});
       localStorage.setItem('delivery_rn', JSON.stringify(rn));
       renderRun();
   }

   function renderRun() {
       const list = document.getElementById('run-list'); list.innerHTML = '';
       rn.forEach((item, idx) => {
           const div = document.createElement('div');
           div.className = 'card';
           div.innerHTML = `
               <div class="handle">â‰¡</div>
               <div class="num-badge">${idx + 1}</div>
               <div class="info">
                   <h4>${item.n}</h4>
                   <p>${item.a}</p>
                   ${(item.t && item.t !== '---' && item.t !== 'null') ? `<span style="color:var(--p); font-size:11px; font-weight:bold;">âŒš ${item.t}</span>` : ''}
               </div>
               <button class="btn-go" onclick="goSingle('${item.a.replace(/'/g, "\\'")}')">GO</button>
               <button class="btn-del" onclick="del(${idx})">âœ•</button>`;
           list.appendChild(div);
       });
   }

   function startFullRoute() {
       if(!rn.length) return;
       const addr = rn.map(i => i.a.trim());
       // Î‘Ï€Î»ÏŒ ÏƒÏ„Î­Î»ÏƒÎ¹Î¼Î¿ - ÎµÏƒÏ Ï„Î± Î­Ï‡ÎµÎ¹Ï‚ Î²Î¬Î»ÎµÎ¹ Î®Î´Î· ÏƒÏ„Î· ÏƒÎµÎ¹ÏÎ¬ Î¼Îµ Ï„Î¿ Ï‡Î­ÏÎ¹
       window.location.href = "comgooglemaps://?saddr=&daddr=" + encodeURIComponent(addr.join(' to:')) + "&directionsmode=driving";
   }

   function smartSort() {
       if(!rn.length) return;
       let hasTime = rn.filter(i => i.t !== "---" && i.t && i.t !== 'null');
       let noTime = rn.filter(i => i.t === "---" || !i.t || i.t === 'null');
       hasTime.sort((a, b) => a.t.localeCompare(b.t));
       // Î¤Î¿Ï…Ï‚ Î²Î¬Î¶Î¿Ï…Î¼Îµ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚ Î³Î¹Î± Î½Î± Î¼Î·Î½ ÎµÎ½Î¿Ï‡Î»Î¿ÏÎ½ Ï„Î· ÏÎ¿Î® Ï„Î·Ï‚ Î³ÎµÎ¹Ï„Î¿Î½Î¹Î¬Ï‚
       rn = [...noTime, ...hasTime];
       localStorage.setItem('delivery_rn', JSON.stringify(rn));
       renderRun();
   }

   function goSingle(a) {
       window.location.href = "comgooglemaps://?daddr=" + encodeURIComponent(a) + "&directionsmode=driving";
   }

   function del(i) { rn.splice(i,1); localStorage.setItem('delivery_rn', JSON.stringify(rn)); renderRun(); }
   function clearRun() { if(confirm('Î˜Î­Î»ÎµÎ¹Ï‚ Î½Î± ÏƒÎ²Î®ÏƒÎµÎ¹Ï‚ ÏŒÎ»Î· Ï„Î· Î»Î¯ÏƒÏ„Î± Î·Î¼Î­ÏÎ±Ï‚;')){ rn=[]; localStorage.setItem('delivery_rn', JSON.stringify(rn)); renderRun(); } }

   new Sortable(document.getElementById('run-list'), {
       animation: 150,
       handle: '.handle',
       onEnd: (evt) => {
           const movedItem = rn.splice(evt.oldIndex, 1)[0];
           rn.splice(evt.newIndex, 0, movedItem);
           localStorage.setItem('delivery_rn', JSON.stringify(rn));
           renderRun();
       }
   });
   tab('run');
</script>
</body>
</html>
